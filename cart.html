<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Gi·ªè h√†ng</title>
    <link rel="stylesheet" href="stylecart.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

</head>

<body>
    <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
    <div id="cart-container"></div>
    <h3 id="total"></h3>
    <button id="checkout">Thanh to√°n</button>

    <!-- Th√¥ng b√°o -->
    <div id="toast"></div>

    <!-- KHUY·∫æN M√ÉI -->
    <div class="coupon-section">
        <h3>üéü M√£ gi·∫£m gi√°</h3>
        <div class="coupon-box">
            <select id="coupon">
                <option value="0">-- Kh√¥ng √°p d·ª•ng --</option>
                <option value="10">Gi·∫£m 10%</option>
                <option value="50000">Gi·∫£m 50,000‚Ç´</option>
                <option value="100000">Gi·∫£m 100,000‚Ç´</option>
            </select>
            <button id="applyCoupon">√Åp d·ª•ng</button>
        </div>
        <p id="coupon-message"></p>
    </div>



    <script src="cart.js"></script>
    <script>
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        let container = document.getElementById("cart-container");
        let totalEl = document.getElementById("total");

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showToast(message, type = "info")
        {
            const toast = document.getElementById("toast");
            toast.innerText = message;

            toast.className = "show";
            if (type === "success") toast.style.background = "#4caf50";
            if (type === "error") toast.style.background = "#f44336";
            if (type === "info") toast.style.background = "#2196f3";

            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2500);
        }

        // Render gi·ªè h√†ng
        function renderCart()
        {
            container.innerHTML = "";
            let total = 0;

            if (cart.length === 0)
            {
                container.innerHTML = "<p>Gi·ªè h√†ng tr·ªëng.</p>";
                totalEl.innerText = "";
                return;
            }

            cart.forEach((item, index) =>
            {
                let priceNum = parseInt(item.price.replace(/[^\d]/g, ""));
                total += priceNum * item.quantity;

                let div = document.createElement("div");
                div.classList.add("cart-item");
                div.innerHTML = `
      <img src="${item.image}" alt="${item.name}">
      <div class="cart-details">
        <b>${item.name}</b><br>
        ${item.price}
      </div>
      <div class="cart-actions">
        <button class="btn-dec" onclick="changeQuantity(${index}, -1)">-</button>
        <span>${item.quantity}</span>
        <button class="btn-inc" onclick="changeQuantity(${index}, 1)">+</button>
        <button class="btn-del" onclick="removeItem(${index})">X√≥a</button>
      </div>
    `;
                container.appendChild(div);
            });

            totalEl.innerText = "T·ªïng: " + total.toLocaleString("vi-VN") + "‚Ç´";
        }

        // Thay ƒë·ªïi s·ªë l∆∞·ª£ng
        function changeQuantity(i, delta)
        {
            if (!cart[i]) return;
            cart[i].quantity += delta;

            if (cart[i].quantity <= 0)
            {
                cart.splice(i, 1);
                showToast("ƒê√£ x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng", "error");
            } else
            {
                showToast("C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng: " + cart[i].quantity, "info");
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
        }

        // X√≥a s·∫£n ph·∫©m
        function removeItem(i)
        {
            cart.splice(i, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
            showToast("S·∫£n ph·∫©m ƒë√£ b·ªã x√≥a!", "error");
        }

        // Thanh to√°n
        document.getElementById("checkout").addEventListener("click", () =>
        {
            if (cart.length === 0)
            {
                showToast("Gi·ªè h√†ng tr·ªëng, kh√¥ng th·ªÉ thanh to√°n!", "error");
                return;
            }
            showToast("Thanh to√°n th√†nh c√¥ng!", "success");
            localStorage.removeItem("cart");
            cart = [];
            renderCart();
        });

        // L·∫ßn ƒë·∫ßu load
        renderCart();

    </script>

    <script src="coupon.js"></script>
</body>

</html>