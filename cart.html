<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Giỏ hàng</title>
    <link rel="stylesheet" href="stylecart.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

</head>

<body>
    <h2>Giỏ hàng của bạn</h2>
    <div id="cart-container"></div>
    <h3 id="total"></h3>
    <button id="checkout">Thanh toán</button>

    <!-- Thông báo -->
    <div id="toast"></div>

    <script src="cart.js"></script>
    <script>
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        let container = document.getElementById("cart-container");
        let totalEl = document.getElementById("total");

        // Hiển thị toast
        function showToast(message, type = "info")
        {
            const toast = document.getElementById("toast");
            toast.innerText = message;

            toast.className = "show";
            if (type === "success") toast.style.background = "#4caf50";
            if (type === "error") toast.style.background = "#f44336";
            if (type === "info") toast.style.background = "#2196f3";

            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2500);
        }

        // Render giỏ hàng
        function renderCart()
        {
            container.innerHTML = "";
            let total = 0;

            if (cart.length === 0)
            {
                container.innerHTML = "<p>Giỏ hàng trống.</p>";
                totalEl.innerText = "";
                return;
            }

            cart.forEach((item, index) =>
            {
                let priceNum = parseInt(item.price.replace(/[^\d]/g, ""));
                total += priceNum * item.quantity;

                let div = document.createElement("div");
                div.classList.add("cart-item");
                div.innerHTML = `
      <img src="${item.image}" alt="${item.name}">
      <div class="cart-details">
        <b>${item.name}</b><br>
        ${item.price}
      </div>
      <div class="cart-actions">
        <button class="btn-dec" onclick="changeQuantity(${index}, -1)">-</button>
        <span>${item.quantity}</span>
        <button class="btn-inc" onclick="changeQuantity(${index}, 1)">+</button>
        <button class="btn-del" onclick="removeItem(${index})">Xóa</button>
      </div>
    `;
                container.appendChild(div);
            });

            totalEl.innerText = "Tổng: " + total.toLocaleString("vi-VN") + "₫";
        }

        // Thay đổi số lượng
        function changeQuantity(i, delta)
        {
            if (!cart[i]) return;
            cart[i].quantity += delta;

            if (cart[i].quantity <= 0)
            {
                cart.splice(i, 1);
                showToast("Đã xóa sản phẩm khỏi giỏ hàng", "error");
            } else
            {
                showToast("Cập nhật số lượng: " + cart[i].quantity, "info");
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
        }

        // Xóa sản phẩm
        function removeItem(i)
        {
            cart.splice(i, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
            showToast("Sản phẩm đã bị xóa!", "error");
        }

        // Thanh toán
        document.getElementById("checkout").addEventListener("click", () =>
        {
            if (cart.length === 0)
            {
                showToast("Giỏ hàng trống, không thể thanh toán!", "error");
                return;
            }
            showToast("Thanh toán thành công!", "success");
            localStorage.removeItem("cart");
            cart = [];
            renderCart();
        });

        // Lần đầu load
        renderCart();

    </script>
</body>

</html>